local Material = loadstring(game:HttpGet("https://raw.githubusercontent.com/NiceBBMBThai12/NBTScript/main/Gui%20Th%20Edit%20free%2001"))()
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")

local ValidKeys = {"1234"}
local DiscordLink = "https://discord.gg/XvNWzjdqpm"
local KeyStorageName = "SavedKey.txt"

-- Show notification
local function ShowNotification(title, message, duration)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = title,
            Text = message,
            Duration = duration or 3
        })
    end)
end

-- Save/load/remove key
local function SaveKey(key)
    pcall(function()
        writefile(KeyStorageName, key)
    end)
end

local function LoadSavedKey()
    if isfile(KeyStorageName) then
        local success, key = pcall(function()
            return readfile(KeyStorageName)
        end)
        if success and key then
            return key
        end
    end
    return nil
end

local function RemoveSavedKey()
    pcall(function()
        delfile(KeyStorageName)
    end)
end

local function ValidateKey(key)
    for _, validKey in pairs(ValidKeys) do
        if key == validKey then
            return true
        end
    end
    return false
end


local XX = Material.Load({
    Title = "SAB Paid",
    Style = 1,
    SizeX = 450,
    SizeY = 300,
    Theme = "Dark"
})

local isWhitelisted = false
local StatusLabel = nil
local ScriptsTab = nil
local KeyInput = ""

-- Function to create script buttons
local function CreateScriptButtons()
    if not ScriptsTab then return end
    ScriptsTab.Label({
        Text = "Status: Whitelisted (Lifetime)"
    })
    ScriptsTab.Button({
        Text = "Float",
        Callback = function()
            ShowNotification("Script Loading", "Loading Float script...", 2)
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/Jairoxdhola/Stealabrainrot/refs/heads/main/Stealabrainrot"))()
            end)
        end
    })
    ScriptsTab.Button({
        Text = "Server Hop",
        Callback = function()
            ShowNotification("Script Loading", "Loading Server Hop script...", 2)
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/ily123950/Hopper/refs/heads/main/releaseass.txt"))()
            end)
        end
    })
    ScriptsTab.Button({
        Text = "Chilli Hub",
        Callback = function()
            ShowNotification("Script Loading", "Loading Chilli Hub...", 2)
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/tienkhanh1/spicy/main/Chilli.lua"))()
            end)
        end
    })
    
end

-- Main GUI
local KeyTab = XX.New({
    Title = "Key Authentication"
})

KeyTab.Button({
    Text = "Get Key (Copy Discord Link)",
    Callback = function()
        setclipboard(DiscordLink)
        ShowNotification("Key System", "Discord link copied to clipboard!", 3)
    end
})

local UserInputService = game:GetService("UserInputService")
local keyTextBox = nil
KeyTab.TextField({
    Text = "Enter Key Here",
    Callback = function(Value, TextBox)
        KeyInput = Value
        if not keyTextBox and TextBox then
            keyTextBox = TextBox
        end
    end
})

-- Add a mobile hint label
if UserInputService.TouchEnabled then
    KeyTab.Label({
        Text = "[MOBILE] Tap the input box to type your key. If the keyboard does not appear, tap again."
    })
    task.spawn(function()
        repeat wait() until keyTextBox
        if keyTextBox then
            keyTextBox.ClearTextOnFocus = true
            keyTextBox.MouseButton1Click:Connect(function()
                keyTextBox:CaptureFocus()
            end)
        else
            ShowNotification("Mobile Input", "If the keyboard does not appear, tap the input box again.", 4)
        end
    end)
end

KeyTab.Button({
    Text = "Submit Key",
    Callback = function()
        if ValidateKey(KeyInput) then
            SaveKey(KeyInput)
            isWhitelisted = true
            ShowNotification("Success!", "Key accepted! Access granted for lifetime.", 5)
            if not ScriptsTab then
                ScriptsTab = XX.New({
                    Title = "Scripts"
                })
                CreateScriptButtons()
            end
            if StatusLabel then
                StatusLabel:Update("Status: Whitelisted (Lifetime)")
            end
        else
            ShowNotification("Error!", "Invalid key! Please try again.", 3)
        end
    end
})

-- Status Label
if LoadSavedKey() and ValidateKey(LoadSavedKey()) then
    isWhitelisted = true
    StatusLabel = KeyTab.Label({
        Text = "Status: Whitelisted (Lifetime)"
    })
    ScriptsTab = XX.New({
        Title = "Scripts"
    })
    CreateScriptButtons()
else
    StatusLabel = KeyTab.Label({
        Text = "Status: Not Whitelisted"
    })
end


game.Players.LocalPlayer.Chatted:Connect(function(message)
    if message:lower() == "/resetkey" then
        RemoveSavedKey()
        isWhitelisted = false
        if StatusLabel then
            StatusLabel:Update("Status: Key Reset - Please re-enter key")
        end
        ShowNotification("Key Reset", "Your saved key has been cleared.", 3)
    elseif message:lower() == "/checkstatus" then
        if isWhitelisted then
            ShowNotification("Status Check", "You are currently whitelisted with lifetime access.", 3)
        else
            ShowNotification("Status Check", "You are not whitelisted. Please enter a valid key.", 3)
        end
    end
end)
